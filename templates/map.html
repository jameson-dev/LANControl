{% extends "base.html" %}

{% block title %}Network Map - LANControl{% endblock %}

{% block extra_head %}
<script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
<style>
    #networkCanvas {
        width: 100%;
        height: calc(100vh - 220px);
        min-height: 500px;
        border: 1px solid rgba(255, 255, 255, 0.1);
    }
</style>
{% endblock %}

{% block content %}
<div class="space-y-6">
    <!-- Header -->
    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
        <div>
            <h2 class="text-2xl sm:text-3xl font-bold text-white">Network Topology Map</h2>
            <p class="text-gray-400 text-sm mt-1">Visualize your network connections</p>
        </div>
        <div class="flex flex-wrap gap-2 sm:gap-3">
            <button onclick="discoverTopology()"
                    id="discoverBtn"
                    class="px-4 py-2 glass hover:glass-hover bg-blue-600/20 hover:bg-blue-600/30 text-white rounded-lg font-medium transition">
                <span id="discoverBtnText">Discover Topology</span>
            </button>
            <button onclick="centerNetwork()"
                    class="px-4 py-2 glass hover:glass-hover bg-purple-600/20 hover:bg-purple-600/30 text-white rounded-lg font-medium transition">
                Center View
            </button>
            <button onclick="exportTopology()"
                    class="px-4 py-2 glass hover:glass-hover bg-green-600/20 hover:bg-green-600/30 text-white rounded-lg font-medium transition">
                Export PNG
            </button>
        </div>
    </div>

    <!-- Controls -->
    <div class="glass rounded-lg p-4">
        <div class="flex flex-wrap items-center gap-4">
            <div class="flex items-center gap-2">
                <label class="text-sm text-gray-300">Layout:</label>
                <select id="layoutSelect" onchange="changeLayout()" class="px-3 py-2 glass-input rounded-lg text-white text-sm">
                    <option value="hierarchical">Hierarchical</option>
                    <option value="force">Force-Directed</option>
                    <option value="circular">Circular</option>
                </select>
            </div>
            <div class="flex items-center gap-2">
                <label class="flex items-center gap-2 cursor-pointer">
                    <input type="checkbox" id="showLabels" onchange="toggleLabels()" checked class="form-checkbox h-4 w-4">
                    <span class="text-sm text-gray-300">Show Labels</span>
                </label>
            </div>
            <div class="flex items-center gap-2">
                <label class="flex items-center gap-2 cursor-pointer">
                    <input type="checkbox" id="physicsEnabled" onchange="togglePhysics()" checked class="form-checkbox h-4 w-4">
                    <span class="text-sm text-gray-300">Physics</span>
                </label>
            </div>
            <div class="ml-auto text-sm text-gray-400" id="nodeCount">
                0 devices
            </div>
        </div>
    </div>

    <!-- Legend -->
    <div class="glass rounded-lg p-4">
        <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-6 gap-4">
            <div>
                <div class="text-xs text-gray-400 mb-2 font-medium">Status</div>
                <div class="space-y-1">
                    <div class="flex items-center gap-2">
                        <div class="w-3 h-3 rounded-full bg-green-500"></div>
                        <span class="text-xs text-gray-300">Online</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <div class="w-3 h-3 rounded-full bg-red-500"></div>
                        <span class="text-xs text-gray-300">Offline</span>
                    </div>
                </div>
            </div>
            <div>
                <div class="text-xs text-gray-400 mb-2 font-medium">Device Types</div>
                <div class="space-y-1">
                    <div class="flex items-center gap-2">
                        <div class="w-4 h-4 bg-blue-500 rotate-45"></div>
                        <span class="text-xs text-gray-300">Router/Gateway</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <div class="w-3 h-3 bg-blue-500"></div>
                        <span class="text-xs text-gray-300">Switch</span>
                    </div>
                </div>
            </div>
            <div>
                <div class="text-xs text-gray-400 mb-2 font-medium">&nbsp;</div>
                <div class="space-y-1">
                    <div class="flex items-center gap-2">
                        <div class="w-3 h-3 rounded-full bg-blue-500"></div>
                        <span class="text-xs text-gray-300">Client Device</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <div class="w-3 h-2.5 bg-blue-500"></div>
                        <span class="text-xs text-gray-300">Printer</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Network Canvas -->
    <div class="glass rounded-lg p-4">
        <div id="networkCanvas"></div>
    </div>

    <!-- Device Info Panel -->
    <div id="deviceInfo" class="hidden glass rounded-lg p-4">
        <h3 class="text-lg font-bold text-white mb-3">Device Details</h3>
        <div id="deviceInfoContent" class="space-y-2 text-sm">
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script src="{{ url_for('static', filename='js/map.js') }}"></script>
{% endblock %}
